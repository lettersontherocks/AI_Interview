<!-- pages/interview/interview.wxml -->
<view class="container">
  <!-- é¡¶éƒ¨è¿›åº¦ -->
  <view class="progress-bar">
    <view class="progress-fill animated" style="width: {{progress}}%"></view>
  </view>
  <view class="progress-text">{{finished ? 'é¢è¯•å·²å®Œæˆ' : 'é¢è¯•è¿›è¡Œä¸­'}}</view>

  <!-- å¯¹è¯è®°å½• -->
  <scroll-view class="chat-area" scroll-y scroll-into-view="{{scrollToView}}" scroll-with-animation>
    <view
      class="message-item {{item.role}}"
      wx:for="{{messages}}"
      wx:key="index"
      id="msg-{{index}}"
    >
      <view class="message-avatar">
        <text wx:if="{{item.role === 'interviewer'}}">ğŸ‘”</text>
        <text wx:else>ğŸ‘¤</text>
      </view>
      <view class="message-content">
        <view class="message-text">{{item.content}}</view>
        <view wx:if="{{item.score}}" class="message-feedback">
          <view class="score">è¯„åˆ†: {{item.score}}/10</view>
          <view wx:if="{{item.hint}}" class="hint">{{item.hint}}</view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½ä¸­ -->
    <view wx:if="{{loading}}" class="message-item interviewer">
      <view class="message-avatar">ğŸ‘”</view>
      <view class="message-content">
        <view class="typing-indicator">
          <span></span><span></span><span></span>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- è¾“å…¥åŒºåŸŸ -->
  <view class="input-area" wx:if="{{!finished}}">
    <!-- æ¨¡å¼åˆ‡æ¢æŒ‰é’® -->
    <view class="mode-toggle" bindtap="toggleInputMode">
      <text class="mode-icon">{{inputMode === 'text' ? 'ğŸ¤' : 'âŒ¨ï¸'}}</text>
    </view>

    <!-- æ–‡å­—è¾“å…¥æ¨¡å¼ -->
    <view class="text-input-wrapper" wx:if="{{inputMode === 'text'}}">
      <textarea
        class="answer-input"
        placeholder="è¯·è¾“å…¥æ‚¨çš„å›ç­”..."
        bindinput="inputAnswer"
        value="{{currentAnswer}}"
        auto-height
        maxlength="1000"
        disabled="{{loading}}"
      />
      <button
        class="send-btn primary-btn"
        bindtap="submitAnswer"
        disabled="{{!canSend || loading}}"
      >
        å‘é€
      </button>
    </view>

    <!-- è¯­éŸ³è¾“å…¥æ¨¡å¼ -->
    <view class="voice-input-wrapper" wx:else>
      <view class="voice-status" wx:if="{{!isRecording}}">
        <text class="voice-hint">æŒ‰ä½è¯´è¯</text>
      </view>
      <view class="voice-status recording" wx:else>
        <view class="recording-animation">
          <view class="wave"></view>
          <view class="wave"></view>
          <view class="wave"></view>
        </view>
        <text class="recording-time">{{recordDuration}}s</text>
      </view>
      <button
        class="record-btn"
        bindtouchstart="startRecord"
        bindtouchend="stopRecord"
        bindtouchcancel="stopRecord"
        disabled="{{loading}}"
      >
        {{isRecording ? 'æ¾å¼€å‘é€' : 'æŒ‰ä½è¯´è¯'}}
      </button>
    </view>
  </view>

  <!-- å®Œæˆæç¤º -->
  <view class="finish-area" wx:if="{{finished}}">
    <view class="finish-icon">âœ…</view>
    <view class="finish-title">é¢è¯•å·²å®Œæˆ</view>
    <view class="finish-subtitle">æ­£åœ¨ç”Ÿæˆé¢è¯•æŠ¥å‘Š...</view>
    <button class="view-report-btn primary-btn" bindtap="viewReport">
      æŸ¥çœ‹æŠ¥å‘Š
    </button>
  </view>
</view>
