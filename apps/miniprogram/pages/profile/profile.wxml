<!-- pages/profile/profile.wxml -->
<view class="container">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-card">
    <image class="avatar" src="{{userInfo.avatar || '/assets/default-avatar.png'}}" mode="aspectFill"></image>
    <view class="user-info">
      <text class="nickname">{{userInfo.nickname || 'æœªç™»å½•'}}</text>
      <view class="vip-badge" wx:if="{{userInfo.vip_type}}">
        <text class="vip-icon">{{userInfo.vip_type === 'super' ? 'ğŸŒŸ' : 'â­'}}</text>
        <text class="vip-text">{{userInfo.vip_type === 'super' ? 'è¶…çº§VIP' : 'æ™®é€šVIP'}}</text>
      </view>
      <text class="quota-text" wx:else>ä»Šæ—¥å‰©ä½™: {{userInfo.free_count_today || 0}}/1æ¬¡</text>
    </view>
  </view>

  <!-- VIPå°å¡ç‰‡ -->
  <view class="vip-mini-card" bindtap="goToVipPage">
    <view class="vip-mini-left">
      <text class="vip-mini-icon">ğŸ‘‘</text>
      <view class="vip-mini-info">
        <text class="vip-mini-title">{{userInfo.vip_type === 'super' ? 'è¶…çº§VIP' : (userInfo.vip_type === 'normal' ? 'æ™®é€šVIP' : 'å¼€é€šVIPä¼šå‘˜')}}</text>
        <text class="vip-mini-desc">{{userInfo.vip_type ? 'æŸ¥çœ‹ä¼šå‘˜è¯¦æƒ…' : 'æ— é™ç»ƒä¹  ä¸“ä¸šæå‡'}}</text>
      </view>
    </view>
    <view class="vip-mini-arrow">â€º</view>
  </view>

  <!-- é¢è¯•è®°å½• -->
  <view class="history-card">
    <view class="card-header">
      <text class="card-title">é¢è¯•è®°å½•</text>
      <text class="view-all" bindtap="viewAllHistory">æŸ¥çœ‹å…¨éƒ¨ ></text>
    </view>

    <view wx:if="{{historyList.length === 0}}" class="empty-state">
      <text class="empty-text">æš‚æ— é¢è¯•è®°å½•</text>
      <button class="start-practice-btn" bindtap="goToIndex">å¼€å§‹ç»ƒä¹ </button>
    </view>

    <scroll-view wx:else scroll-y class="history-list">
      <view class="history-item" wx:for="{{historyList}}" wx:key="session_id">
        <view class="history-header">
          <text class="position-tag">{{item.position}}</text>
          <text class="round-tag">{{item.round}}</text>
        </view>
        <view class="history-content">
          <text class="score-text">æ€»åˆ†: {{item.score}}åˆ†</text>
          <text class="date-text">{{item.date}}</text>
        </view>
        <view class="history-footer">
          <view class="level-badge {{item.is_finished ? 'completed' : 'unfinished'}}">
            {{item.level}}
          </view>
          <button
            wx:if="{{!item.is_finished}}"
            class="action-btn continue-btn"
            bindtap="continueInterview"
            data-session-id="{{item.session_id}}"
          >
            <text class="btn-icon">â–¶</text>
            <text class="btn-text">ç»§ç»­é¢è¯•</text>
          </button>
          <button
            wx:else
            class="action-btn view-btn"
            bindtap="viewReport"
            data-session-id="{{item.session_id}}"
          >
            <text class="btn-icon">ğŸ“Š</text>
            <text class="btn-text">æŸ¥çœ‹æŠ¥å‘Š</text>
          </button>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- è®¾ç½®é€‰é¡¹ -->
  <view class="settings-card">
    <view class="setting-item" bindtap="clearCache">
      <text class="setting-label">æ¸…é™¤ç¼“å­˜</text>
      <text class="setting-arrow">></text>
    </view>
    <view class="setting-item" bindtap="contactSupport">
      <text class="setting-label">è”ç³»å®¢æœ</text>
      <text class="setting-arrow">></text>
    </view>
    <view class="setting-item" bindtap="aboutUs">
      <text class="setting-label">å…³äºæˆ‘ä»¬</text>
      <text class="setting-arrow">></text>
    </view>
  </view>

  <!-- é€€å‡ºç™»å½• -->
  <button class="logout-btn" bindtap="logout" wx:if="{{userInfo.nickname}}">é€€å‡ºç™»å½•</button>
</view>
